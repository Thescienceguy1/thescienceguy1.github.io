<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Messier Gallery — Isaac Ceballos</title>
  <style>
    :root{--ink:#e2e8f0;--sub:#94a3b8;--bg1:#0f172a;--bg2:#000000;--card:#0b1220;--border:#0ea5e933}
    *{box-sizing:border-box;margin:0;padding:0}
    body{font-family:monospace;color:var(--ink);background:linear-gradient(180deg,var(--bg1) 0%,var(--bg2) 100%);min-height:100vh}
    header{text-align:center;padding:28px 20px 10px}
    header h1{font-size:1.8rem;letter-spacing:.3px}
    header .subtitle{color:var(--sub);margin-top:6px}
    header .tagline{color:var(--sub);margin-top:4px;font-size:.95rem}
    main{max-width:1200px;margin:18px auto 40px;padding:0 20px}
    .grid{display:grid;grid-template-columns:repeat(4,1fr);gap:16px}
    @media(max-width:1100px){.grid{grid-template-columns:repeat(3,1fr)}}
    @media(max-width:720px){.grid{grid-template-columns:repeat(2,1fr)}}
    @media(max-width:480px){.grid{grid-template-columns:1fr}}
    figure.card{background:var(--card);border:1px solid var(--border);border-radius:16px;overflow:hidden;box-shadow:0 6px 16px rgba(0,0,0,.35);transition:transform .18s ease,box-shadow .18s ease,border-color .18s ease}
    figure.card:hover{transform:translateY(-2px);box-shadow:0 0 18px 6px #38bdf833;border-color:#38bdf8}
    .thumb{width:100%;aspect-ratio:1/1;background:radial-gradient(circle at 30% 20%,rgba(56,189,248,.12),transparent 40%),linear-gradient(145deg,#0b1220,#111827);border-bottom:1px solid #0ea5e922;display:grid;place-items:center}
    .thumb img{width:100%;height:100%;object-fit:cover;display:block}
    figcaption{padding:10px 12px;display:flex;justify-content:space-between;align-items:baseline;gap:8px}
    .obj{font-weight:600}
    .note{font-size:.85rem;color:var(--sub)}
    .empty{margin:24px 0;padding:16px 14px;border:1px dashed #334155;background:#0b1220aa;border-radius:12px;color:var(--sub)}
    footer{text-align:center;padding:22px;color:var(--sub)}
  </style>
</head>
<body>
  <header>
    <h1>Isaac Ceballos</h1>
    <div class="subtitle">Messier Gallery</div>
    <div class="tagline">Where I add my pictures</div>
  </header>

  <main>
    <div id="empty" class="empty">Loading your uploads…</div>
    <section id="grid" class="grid" aria-live="polite" aria-busy="true"></section>
  </main>

  <footer>&copy; 2025 Isaac Ceballos.</footer>

  <script>
    // ======= CONFIG =======
    const BASE_DIR = 'images/messier/'; // folder with your images
    const EXT = 'png';                  // file extension (png by default)
    const ZERO_PAD = 0;                 // 0 means M1.png, set 2 for M01.png, 3 for M001.png
    const START = 1, END = 110;         // range to scan
    const CONCURRENCY = 12;             // how many image checks at once
    const CACHE_VERSION = '';           // optional like '?v=1' to hard refresh after updates

    // Build the file name for a given number
    function buildName(n) {
      const num = ZERO_PAD > 0 ? String(n).padStart(ZERO_PAD, '0') : String(n);
      return `M${num}.${EXT}`;
    }

    function imgExists(url) {
      return new Promise(resolve => {
        const test = new Image();
        test.onload = () => resolve(true);
        test.onerror = () => resolve(false);
        // use a stable cache key per page load to avoid hammering network
        const cb = CACHE_VERSION ? CACHE_VERSION : '';
        test.src = url + cb;
      });
    }

    function makeCard(id, src) {
      const fig = document.createElement('figure'); fig.className = 'card';
      const thumb = document.createElement('div'); thumb.className = 'thumb';
      const img = document.createElement('img'); img.alt = id; img.loading = 'lazy'; img.decoding = 'async'; img.src = src;
      thumb.appendChild(img);
      const cap = document.createElement('figcaption');
      const name = document.createElement('span'); name.className = 'obj'; name.textContent = id;
      const note = document.createElement('span'); note.className = 'note'; note.textContent = EXT.toUpperCase();
      cap.appendChild(name); cap.appendChild(note);
      fig.appendChild(thumb); fig.appendChild(cap);
      return fig;
    }

    // Concurrency limiter
    async function mapLimit(items, limit, task) {
      const results = new Array(items.length);
      let i = 0;
      const workers = new Array(Math.min(limit, items.length)).fill(0).map(async () => {
        while (i < items.length) {
          const idx = i++;
          results[idx] = await task(items[idx], idx);
        }
      });
      await Promise.all(workers);
      return results;
    }

    (async () => {
      const grid = document.getElementById('grid');
      const empty = document.getElementById('empty');

      // Build the list M1..M110 in order
      const nums = Array.from({length: END - START + 1}, (_, k) => START + k);

      // Check which ones exist, with limited concurrency
      const found = await mapLimit(nums, CONCURRENCY, async (n) => {
        const file = buildName(n);
        const url = BASE_DIR + file;
        const ok = await imgExists(url);
        return ok ? { n, url } : null;
      });

      // Render strictly in numeric order
      let count = 0;
      for (const n of nums) {
        const item = found.find(x => x && x.n === n);
        if (!item) continue;
        grid.appendChild(makeCard(`M${n}`, item.url));
        count++;
      }

      grid.setAttribute('aria-busy', 'false');
      empty.style.display = count ? 'none' : 'block';
      if (!count) empty.textContent = `No images found under ${BASE_DIR}`;
    })();
  </script>
</body>
</html>
